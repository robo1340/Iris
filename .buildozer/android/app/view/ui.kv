<SmallLabel@Label>:
    canvas.before:
        Color:
            rgba: [0.5, 0.5, 0.5, 1]
        Line:
            width: 1
            rectangle: self.x, self.y, self.width, self.height
    size_hint : (1, None)
    height : 20
    font_size: 15
    text_size: self.size
    halign: 'left'
    color: [0,0,0,1]
    padding_x : 3

<SmallToggleButton@ToggleButton>:
    canvas.before:
        Color:
            rgba: [0.5, 0.5, 0.5, 1]
        Line:
            width: 1
            rectangle: self.x, self.y, self.width, self.height
    size_hint : (1, None)
    height : 20
    font_size : 15
    
<SmallButton@Button>:
    canvas.before:
        Color:
            rgba: [0.5, 0.5, 0.5, 1]
        Line:
            width: 1
            rectangle: self.x, self.y, self.width, self.height
    size_hint : (1, None)
    height : 20
    font_size : 15
 
    
<PropertyLabel@BoxLayout>:
    id : property
    orientation: 'horizontal'
    key_text : 'default'
    value_text : '0'
    size_hint : (1, None)
    height : 20
    SmallLabel:
        size_hint_x : 0.5
        id : key
        text: property.key_text
    SmallLabel:
        size_hint_x : 0.5
        id : value
        text: property.value_text
        halign : 'right'
  
  
<SetablePropertyMyCallsign@BoxLayout>:
    id : property
    orientation: 'horizontal'
    size_hint : (1, None)
    height : 20
    text : '______'
    SmallLabel:
        id : key
        text: 'My Callsign:'
    TextInput:
        multiline : False
        padding : [1,1,1,1]
        font_size: self.height - 4
        id : value
        text: property.text
        halign : 'left'
        valign : 'center'
        on_text : app.uiSetMyCallsign(value)

<SetablePropertyDstCallsign@BoxLayout>:
    id : property
    orientation: 'horizontal'
    size_hint : (1, None)
    height : 20
    text : '______'
    SmallLabel:
        id : key
        text: 'DST:'
    TextInput:
        multiline : False
        padding : [1,1,1,1]
        font_size: self.height - 4
        id : value
        text: property.text
        halign : 'left'
        valign : 'center'
        on_text : app.uiSetDstCallsign(value)

<TextMessage>: #extends box layout, is instantiated in ui_kivy.py
    size_hint : (1, None)
    height : message_header.height + message_body.height
    id : message_widget
    orientation: 'vertical'
    header_text : ''
    time_text   : ''
    message_text: ''
    background_color : [1,1,1,1]
    canvas:
        Color:
            rgba: [0, 0, 0, 1]
        Line:
            width: 1
            rectangle: self.x, self.y, self.width, self.height
    canvas.before:
        Color:
            rgba: message_widget.background_color
        Rectangle:
            size: self.size
            pos: self.pos
            

    BoxLayout:
        id : message_header
        orientation : 'horizontal'
        size_hint : (1,None)
        height : lbl.height
        SmallLabel:
            id : lbl
            text : message_widget.header_text
        SmallLabel:
            text : message_widget.time_text
      
    Label:
        id : message_body
        size_hint : (1, None)
        height : self.texture_size[1] #make the label just tall enough to fit all the text
        text_size: (self.width, None)
        font_size: 15
        halign: 'left'
        valign: 'top'
        color: [0,0,0,1]
        padding_x : 5
        padding_y : 3
        text : message_widget.message_text
            
###################################################################        
########################## Root Widget ############################
###################################################################

BoxLayout:
    orientation: 'vertical'
    
    ### Define colors ###
    background_color    : [1,1,1,1]
    black               : [0,0,0,1]
    gray                : [0.5, 0.5, 0.5, 1]
    
    indicator_rx_color          : [0,0,1,1]
    indicator_tx_color          : [1,0,0,1]
    indicator_success_color     : [0,1,0,1]
    indicator_inactive_color    : [0,0,0,1]
    indicator_color             : [0,0,0,1]
    
    toggle_button_color         : [0,1,0,1]
    
    text_msg_color      : [0.9, 0.9, 0.9, 1]
    text_msg_at_color   : [1, 0.25, 0.25, 1]
    text_msg_color_ack_pending : [1,0.5,0.5,1]
    text_msg_color_ack_received: [0,1,0,1]
    text_msg_color_no_ack_expect:[0.9,1,0.8,1]
    
    left_colw : 0.1
    center_colw : 0.7
    right_colw : 0.2
    
    top_rowh : 0.1
    center_rowh : 0.6
    bottom_rowh : 0.3
    
    canvas.before:
        Color:
            rgba: root.background_color
        Rectangle:
            size: self.size
            pos: self.pos

########################### First Row ####################################    
    BoxLayout: #first row
        canvas.before:
            Color:
                rgba: [0.5, 0.5, 0.5, 1]
            Line:
                width: 1
                rectangle: self.x, self.y, self.width, self.height
        id : first_row
        name : 'first_row'
        size_hint : (1, root.top_rowh)
        orientation: 'horizontal'
        
        
        AnchorLayout:
            name : 'left_top_toolbar'
            anchor_x : 'left'
            anchor_y : 'top'
            size_hint_x : None
            width : 185
            SetablePropertyMyCallsign:
                name : 'my_callsign'

        Label:
            #text : 'placeholder'
            name : ''
            color : root.black
            canvas.before:
                Color:
                    rgba: root.gray
                Line:
                    width: 1
                    rectangle: self.x, self.y, self.width, self.height
            
        Label:
            name : 'status_indicator'
            anchor_x : 'left'
            anchor_y : 'top'
            size_hint_x : None
            width : self.height
            canvas: 
                Color: 
                    rgb: root.indicator_color
                Rectangle: 
                    pos: self.pos 
                    size: self.size 
            
########################### Second Row ####################################            
    BoxLayout: #next row
        name : 'second_row'
        orientation: 'horizontal'    
        size_hint : (1, root.center_rowh)
        canvas.before:
            Color:
                rgba: [0.5, 0.5, 0.5, 1]
            Line:
                width: 1
                rectangle: self.x, self.y, self.width, self.height
                
        AnchorLayout: #left tool pane
            name : 'left_tool_pane'
            anchor_x : 'left'
            anchor_y : 'top'
            size_hint: (root.left_colw, 1)
            Label:
                text_size: self.width, None
                size_hint: 1, None
                height: self.texture_size[1]
                text : 'left tool panel'
                color : root.black
        
        ScrollView: 
            name : 'scroll_bar'
            size_hint: (root.center_colw, 1)
            do_scroll_x: False
            do_scroll_y: True
            bar_width : 10
            bar_inactive_color : self.bar_color
            canvas.before:
                Color:
                    rgba: root.gray
                Line:
                    width: 1
                    rectangle: self.x, self.y, self.width, self.height 
            GridLayout:
                name : 'message_container'
                id : message_container
                cols: 1
                size_hint_y: None
                height: self.minimum_height

        BoxLayout: #right tool pane
            name : 'right_tool_pane'
            size_hint: (root.right_colw, 1) 
            orientation: 'vertical'
            
            PropertyLabel:
                name : 'tx_success_cnt'
                key_text : 'txs'
                value_text : '0'
            PropertyLabel:
                name : 'tx_failure_cnt'
                key_text : 'txf'
                value_text : '0'
            PropertyLabel:
                name : 'rx_success_cnt'
                key_text : 'rxs'
                value_text : '0'
            PropertyLabel:
                name : 'rx_failure_cnt'
                key_text : 'rxf'
                value_text : '0'
            SmallToggleButton:
                text: 'Test tx?'
                id: testTxVar
                name : 'testTxVar'
                #background_color: root.toggle_button_color
                on_state: app.toggle_pressed(self)
            Label:
                #text : 'placeholder'
                color : root.black
                canvas.before:
                    Color:
                        rgba: root.gray
                    Line:
                        width: 1
                        rectangle: self.x, self.y, self.width, self.height                

########################### Third Row ####################################
    BoxLayout: #final row
        name : 'third_row'
        id : third_row
        orientation: 'horizontal'    
        size_hint : (1, root.bottom_rowh) 

        AnchorLayout: #lower left tool panel
            anchor_x : 'left'
            anchor_y : 'top'
            size_hint: (root.left_colw, 1)
            name : 'lower_left_tool_pane'
            Label:
                text_size: self.width, None
                size_hint: 1, None
                height: self.texture_size[1]
                color : root.black
                text : 'lower left tool panel'
    
        TextInput:
            name : 'text_input'
            id : text_input
            size_hint: (root.center_colw, 1)
            focus : True
            
        BoxLayout: #lower right tool panel
            orientation : 'vertical'
            name : 'lower_right_tool_pane'
            size_hint: (root.right_colw, 1)
            
            SetablePropertyDstCallsign:
                name : 'dst_callsign'

            SmallToggleButton:
                text: 'Ack?'
                id: ackChecked
                name : 'ackChecked'
                #background_color: root.toggle_button_color
                on_state: app.toggle_pressed(self)
                
            SmallToggleButton:
                text: 'Clear?'
                id: clearOnSend
                name : 'clearOnSend'
                #background_color: root.toggle_button_color
                on_state: app.toggle_pressed(self)
                
            SmallToggleButton:
                text: 'Scroll?'
                id: autoScroll
                name : 'autoScroll'
                #background_color: root.toggle_button_color
                on_state: app.toggle_pressed(self)
                
            SmallButton:
                text: 'SEND'
                name : 'send'
                height : 40
                #background_color: [1,0,0,1]
                on_release: app.sendMessage(text_input)
                    
            Label:
                name : ''
                #text : 'placeholder'
                color : root.black
                canvas.before:
                    Color:
                        rgba: root.gray
                    Line:
                        width: 1
                        rectangle: self.x, self.y, self.width, self.height  

                